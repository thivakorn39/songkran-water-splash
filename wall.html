<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡∏™‡∏≤‡∏î‡∏ô‡πâ‡∏≥</title>
    <style>
        body {
            font-family: sans-serif;
            background: #fff3e0;
            padding: 2rem;
        }

        .message {
            background: #81d4fa;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 10px;
            font-size: 1.2rem;
        }
    </style>
</head>

<body>
    <h1>üß± ‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå üß±</h1>
    <div id="wall"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, onChildAdded, remove, get } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBMH5oWEqrsPvIHfe6UVeszseV0-QaxtGw",
            authDomain: "songkran-water-splash.firebaseapp.com",
            databaseURL: "https://songkran-water-splash-default-rtdb.firebaseio.com", // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
            projectId: "songkran-water-splash",
            storageBucket: "songkran-water-splash.appspot.com",
            messagingSenderId: "145856517287",
            appId: "1:145856517287:web:63c638840573c3ca79b782",
            measurementId: "G-P4Y1K4Q00B"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const wall = document.getElementById("wall");

        const EXPIRY_MS = 3 * 60 * 60 * 1000; // 3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á

        onChildAdded(ref(db, "messages"), (data) => {
            const msg = data.val();
            const id = data.key;

            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
            if (Date.now() - msg.timestamp > EXPIRY_MS) {
                remove(ref(db, "messages/" + id));
                return;
            }

            const div = document.createElement("div");
            div.className = "message";
            div.textContent = msg.text;
            wall.prepend(div);
        });

        // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏∏‡∏Å‡πÜ 1 ‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(async () => {
            const snapshot = await get(ref(db, "messages"));
            const now = Date.now();
            snapshot.forEach(child => {
                const data = child.val();
                if (now - data.timestamp > EXPIRY_MS) {
                    remove(ref(db, "messages/" + child.key));
                }
            });
        }, 60 * 1000);
    </script>
</body>

</html>