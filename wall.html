<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <title>สงกรานต์ลอยๆ</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #f0f8ff;
            font-family: sans-serif;
        }

        .floating-message-fade,
        .floating-message-bounce {
            position: absolute;
            background-image: url('./splash.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;

            color: white;
            font-weight: bold;
            padding: 60px 80px;
            white-space: nowrap;
            pointer-events: none;

            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6);
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
        }

        .floating-message-fade {
            animation: float linear infinite;
        }

        @keyframes float {
            0% {
                transform: translate(0px, 0px);
                opacity: 1;
            }

            100% {
                transform: translate(var(--dx), var(--dy));
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <div id="wall"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, onChildAdded, remove, get } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBMH5oWEqrsPvIHfe6UVeszseV0-QaxtGw",
            authDomain: "songkran-water-splash.firebaseapp.com",
            projectId: "songkran-water-splash",
            storageBucket: "songkran-water-splash.appspot.com",
            messagingSenderId: "145856517287",
            appId: "1:145856517287:web:63c638840573c3ca79b782"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const EXPIRY_MS = 3 * 60 * 60 * 1000; // 3 ชั่วโมง

        onChildAdded(ref(db, "messages"), (data) => {
            const msg = data.val();
            const id = data.key;

            if (Date.now() - msg.timestamp > EXPIRY_MS) {
                remove(ref(db, "messages/" + id));
                return;
            }

            const div = document.createElement("div");
            div.className = "floating-message-fade";
            div.textContent = msg.text;

            // สไตล์สุ่ม
            div.style.fontSize = `${1 + Math.random()}rem`;
            div.style.color = `hsl(${Math.random() * 360}, 100%, 85%)`;

            const startX = Math.random() * window.innerWidth;
            const startY = Math.random() * window.innerHeight;
            div.style.left = `${startX}px`;
            div.style.top = `${startY}px`;

            const dx = (Math.random() - 0.5) * 500;
            const dy = (Math.random() - 0.5) * 500;
            div.style.setProperty('--dx', `${dx}px`);
            div.style.setProperty('--dy', `${dy}px`);

            const duration = 10 + Math.random() * 10;
            div.style.animationDuration = `${duration}s`;

            document.body.appendChild(div);

            setTimeout(() => {
                div.remove();
            }, duration * 1000);
        });

        // ลบข้อความหมดอายุทุก 1 นาที
        setInterval(async () => {
            const snapshot = await get(ref(db, "messages"));
            const now = Date.now();
            snapshot.forEach(child => {
                const data = child.val();
                if (now - data.timestamp > EXPIRY_MS) {
                    remove(ref(db, "messages/" + child.key));
                }
            });
        }, 60 * 1000);

        const wall = document.getElementById("wall");

        function createFloatingMessage(text) {
            const div = document.createElement("div");
            div.className = "floating-message-bounce";
            div.textContent = text;

            // สไตล์สุ่ม
            div.style.fontSize = `${1 + Math.random()}rem`;
            div.style.color = `hsl(${Math.random() * 360}, 100%, 85%)`;

            wall.appendChild(div);

            let x = Math.random() * (window.innerWidth - 200);
            let y = Math.random() * (window.innerHeight - 100);
            let vx = (Math.random() - 0.5) * 1.5;
            let vy = (Math.random() - 0.5) * 1.5;

            function move() {
                if (x < 0 || x > window.innerWidth - div.offsetWidth) vx *= -1;
                if (y < 0 || y > window.innerHeight - div.offsetHeight) vy *= -1;

                x += vx;
                y += vy;

                div.style.left = `${x}px`;
                div.style.top = `${y}px`;

                requestAnimationFrame(move);
            }

            move();
        }

        // ตัวอย่างการเรียกใช้ (สำหรับทดสอบ)
        // createFloatingMessage("สวัสดีปีใหม่ไทย!");
    </script>

</body>

</html>
